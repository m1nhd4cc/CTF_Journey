import subprocess
import binascii

def geticmp(pcap_file):
    try:
        tshark_command = [
            "tshark",
            "-r", pcap_file,
            "-T", "fields",
            "-e", "data",
            "-Y", "icmp"
        ]
        result = subprocess.run(tshark_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
        
        if result.returncode != 0:
            raise Exception(f"Error running tshark: {result.stderr}")

        hex_data_lines = result.stdout.strip().split("\n")
        hex_data_lines = [line for line in hex_data_lines if line]
        
        if not hex_data_lines:
            return "No ICMP payload data found."
        
        concatenated_hex = "".join(hex_data_lines)
        
        decoded_data = binascii.unhexlify(concatenated_hex).decode('utf-8', errors='ignore')
        
        return decoded_data
    
    except FileNotFoundError:
        return "tshark is not installed or not found in PATH."
    except Exception as e:
        return f"An error occurred: {e}"

if __name__ == "__main__":
    pcap_file_path = "traffic.pcap"
    
    result = geticmp(pcap_file_path)
    
    print("Decoded ICMP Data:")
    print(result)